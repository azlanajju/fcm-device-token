<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Push Notifications</title>
</head>
<body>
  <h1>Firebase Push Notifications</h1>

  <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-messaging.js"></script>

  <script>
    // Initialize Firebase
    var firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);

    const messaging = firebase.messaging();

    // Add the following code if you want to handle the received message while the app is in the foreground
    messaging.onMessage(function (payload) {
      console.log("Received message:", payload);
      // Handle the received message here
    });

    messaging
      .requestPermission()
      .then(function () {
        console.log("Notification permission granted.");
        // You can now send messages to this device
      })
      .catch(function (error) {
        console.log("Unable to get permission to notify.", error);
      });

    messaging
      .getToken({ vapidKey: "YOUR_VAPID_KEY" })
      .then(function (currentToken) {
        if (currentToken) {
          console.log("Registration token:", currentToken);
          // Send this token to your server to associate it with the user
        } else {
          console.log("No registration token available. Request permission to generate one.");
        }
      })
      .catch(function (error) {
        console.log("An error occurred while retrieving the registration token.", error);
      });
  </script>

  <script>
    // Service Worker
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker
          .register("firebase-messaging-sw.js")
          .then(function (registration) {
            console.log("ServiceWorker registration successful with scope:", registration.scope);
          })
          .catch(function (error) {
            console.log("ServiceWorker registration failed:", error);
          });
      });
    }
  </script>

  <script>
    // firebase-messaging-sw.js
    self.addEventListener("push", function (event) {
      if (event.data) {
        const payload = event.data.json();
        console.log("Received background message:", payload);

        const notificationOptions = {
          body: payload.notification.body,
          icon: payload.notification.icon
        };

        event.waitUntil(
          self.registration.showNotification(payload.notification.title, notificationOptions)
        );
      }
    });
  </script>
</body>
</html>
